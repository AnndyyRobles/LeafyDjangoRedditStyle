{% extends 'main.html' %}

{% block content %}
<main class="layout layout--3 techniques-view">
  <!-- Columna izquierda - Lista de técnicas -->
  <div class="topics">
    <div class="topics__header">
      <h2>Técnicas de Cultivo</h2>
    </div>
    <ul class="topics__list">{% for technique in techniques %}
      <li>
        <a href="{% url 'technique' technique.id %}" class="topic-link">
          <span>{{ technique.title }}</span>
        </a>
      </li>{% endfor %}
    </ul>
    <a class="btn btn--link" href="{% url 'create-technique' %}">
      Crear Nueva Técnica
    </a>
  </div>

  <!-- Columna central - Tarjetas de técnicas -->
  <div class="roomList">
    <div class="roomList__header">
      <div>
        <h2>Técnicas de Cultivo</h2>
        <p>{{ techniques.count }} disponibles</p>
      </div>
      <a class="btn btn--main" href="{% url 'create-technique' %}">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
          <title>add</title>
          <path
            d="M16.943 0.943h-1.885v14.115h-14.115v1.885h14.115v14.115h1.885v-14.115h14.115v-1.885h-14.115v-14.115z"
          ></path>
        </svg>
        Crear Técnica
      </a>
    </div>

    <div class="techniques-grid">
      {% for technique in techniques %}
      <a href="{% url 'technique' technique.id %}" class="technique-card">
        <div class="technique-card-title">{{ technique.title }}</div>
        
        <div class="technique-images-container">
          <div class="technique-images-row">
            <div class="technique-image-main">
              {% if technique.main_image %}
              <img src="{{ technique.main_image.url }}" alt="{{ technique.title }}" >
              {% endif %}
            </div>
            <div class="technique-image-secondary">
              {% if technique.image_second %}
              <img src="{{ technique.image_second.url }}" alt="{{ technique.title }}" >
              {% endif %}
            </div>
          </div>
          
          <div class="technique-images-row">
            <div class="technique-image-small">
              {% if technique.image_third %}
              <img src="{{ technique.image_third.url }}" alt="{{ technique.title }}" >
              {% endif %}
            </div>
            <div class="technique-image-small">
              {% if technique.image_fourth %}
              <img src="{{ technique.image_fourth.url }}" alt="{{ technique.title }}" >
              {% endif %}
            </div>
          </div>
        </div>
        
        <div class="technique-tags-container">
          <span class="technique-difficulty">{{ technique.difficulty }}</span>
          <span class="technique-type">{{ technique.name }}</span>
        </div>
        
        <div class="technique-description">
          {{ technique.description|truncatechars:150 }}
        </div>
      </a>
      {% empty %}
      <div class="empty-techniques">
        <p>No hay técnicas de cultivo disponibles aún.</p>
        <a href="{% url 'create-technique' %}" class="btn btn--main">Crear la primera técnica</a>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Columna derecha - Actividad reciente -->
  <div class="activities">
    <div class="activities__header">
      <h2>Actividad Reciente</h2>
    </div>
      {% for message in room_messages %}
      <div class="activities__box">
        <div class="activities__boxHeader roomListRoom__header">
          <a href="{% url 'user-profile' message.user.id %}" class="roomListRoom__author">
            <div class="avatar avatar--small">
              <img src="{{ message.user.avatar.url }}" alt="Avatar de {{ message.user.username }}" />
            </div>
            <p>
              @{{ message.user.username }}
              <span>{{ message.created|timesince }} ago</span>
            </p>
          </a>
          {% if request.user == message.user %}
          <div class="roomListRoom__actions">
            <a href="{% url 'delete-message' message.id %}" title="Eliminar mensaje">
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                <title>remove</title>
                <path
                  d="M27.314 6.019l-1.333-1.333-9.98 9.981-9.981-9.981-1.333 1.333 9.981 9.981-9.981 9.98 1.333 1.333 9.981-9.98 9.98 9.98 1.333-1.333-9.98-9.98 9.98-9.981z"
                ></path>
              </svg>
            </a>
          </div>
          {% endif %}
        </div>
        <div class="activities__boxContent">
          <p>respondió en "<a href="{% url 'room' message.room.id %}">{{ message.room }}</a>"</p>
          <div class="activities__boxRoomContent">{{ message.body }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</main>
{% endblock %}
